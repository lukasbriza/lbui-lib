TODO:
optimize for next typeof document !== undefined
    